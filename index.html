<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>사다리</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .step1 {
        display: flex;
      }
      /* #canvas {
        width: 400px;
        height: 500px;
      } */
    </style>
  </head>
  <body>
    <!-- 1. 사다리 갯수 입력 -->

    <!-- <div class="step1">
      <div class="explain">갯수 선택</div>
      <select id="sel-num">
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13">13</option>
          <option value="14">14</option>
          <option value="15">15</option>
          <option value="16">16</option>
          <option value="17">17</option>
          <option value="18">18</option>
          <option value="19">19</option>
          <option value="20">20</option>
      </select>
      <input type="button" class="num" value="만들기" />
    </div> -->
    <canvas id="canvas" width="500" height="550"></canvas>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const sel = document.querySelector("#sel-num");
      let ballRadius = 5;
      let yTest1 = [];
      let yTest2 = [];
      let y = 30;
      let ex1 = canvas.width / 5 + 25;
      let ex2 = (canvas.width / 5) * 2 + 25;
      let ex3 = (canvas.width / 5) * 3 + 25;
      let isReady = false;
      let state = 1;

      // 기본 창 만들기
      function createWorld() {
        ctx.fillStyle = "#fff000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        //블럭 그리기
        ctx.fillStyle = "green";
        ctx.fillRect(canvas.width / 5, 10, 50, 20);
        ctx.fillRect((canvas.width / 5) * 2, 10, 50, 20);
        ctx.fillRect((canvas.width / 5) * 3, 10, 50, 20);
        ctx.fillRect((canvas.width / 5) * 1, 500, 50, 20);
        ctx.fillRect((canvas.width / 5) * 2, 500, 50, 20);
        ctx.fillRect((canvas.width / 5) * 3, 500, 50, 20);

        //블럭 선 그리기
        ctx.strokeStyle = "black";
        ctx.moveTo(ex1, 10 + 20);
        ctx.lineTo(ex1, 500);
        ctx.moveTo(ex2, 10 + 20);
        ctx.lineTo(ex2, 500);
        ctx.moveTo(ex3, 10 + 20);
        ctx.lineTo(ex3, 500);
        ctx.stroke();
      }

      //사다리 만들기

      function leg() {
        y += 10;
        ctx.beginPath();
        ctx.moveTo(ex1, y);
        if (Math.random(0, 1) * 100 > 85) {
          ctx.lineTo(ex1 + canvas.width / 5, y);
          //xTest1.push(ex1 + canvas.width / 5);
          yTest1.push(y);
        } else {
          ctx.moveTo(ex2, y);
          if (Math.random(0, 1) * 100 > 85) {
            ctx.lineTo(ex2 + canvas.width / 5, y);
            //xTest2.push((canvas.width / 5) * 2 + 25 + canvas.width / 5);
            yTest2.push(y);
          }
        }
        console.log(yTest1);
        //console.log(yTest2);
        ctx.stroke();
        ctx.closePath();
        line = requestAnimationFrame(leg);
        if (y > 470) {
          cancelAnimationFrame(line);
          isReady = true;
        }
      }


      function test() {
        for(let i = 0;i<30;i++){          
          if(y === yTest1[i] && state === 1){
            ex1 = ex2;
            state = 2;
          }else if(state === 2 && y === yTest2[i]){
            ex1 = ex3;
            state = 3;
          }else if(state === 3 && y === yTest2[i]){
            ex1 = ex2;
            state = 2;
          }
          else if(state === 2 && y === yTest1[i]){
            ex1 = canvas.width / 5 + 25;
            state = 1;
          }
        }
        console.log(state);
        ctx.lineTo(ex1, y + 0.5);
        ctx.strokeStyle = "blue";
        ctx.stroke();
        y += 1;
        qwe = requestAnimationFrame(test);
        if (y > 496) {
          cancelAnimationFrame(qwe);
        }
      }
      canvas.addEventListener("click", function(e) {
        console.log(e)}
      );
      canvas.addEventListener("click", function(e) {
        if (isReady) {
          if (
            e.clientX < 150 &&
            e.clientX > 100 &&
            e.clientY < 30 &&
            e.clientY > 10
          ) {
            y = 30;
            ctx.moveTo(ex1, y);
            test();
          }
        }
      });

      (function() {
        createWorld();
        leg();
      })();

    </script>
  </body>
</html>
